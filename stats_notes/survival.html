<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>stats_notes - 4&nbsp; Survival</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./survival_regression.html" rel="next">
<link href="./Clinical Trials.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Survival</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">stats_notes</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Summary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Clinical Trials.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Clinical Trials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Survival</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival_regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Survival</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear_models.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Linear Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">GLMs - Generalized Linear Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc_topics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Miscillanous Topics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#chapter-1---intro" id="toc-chapter-1---intro" class="nav-link active" data-scroll-target="#chapter-1---intro"><span class="toc-section-number">4.1</span>  Chapter 1 - Intro</a>
  <ul class="collapse">
  <li><a href="#distribution-function" id="toc-distribution-function" class="nav-link" data-scroll-target="#distribution-function"><span class="toc-section-number">4.1.1</span>  Distribution Function</a></li>
  <li><a href="#survivor-function" id="toc-survivor-function" class="nav-link" data-scroll-target="#survivor-function"><span class="toc-section-number">4.1.2</span>  Survivor Function</a></li>
  <li><a href="#hazard-function" id="toc-hazard-function" class="nav-link" data-scroll-target="#hazard-function"><span class="toc-section-number">4.1.3</span>  Hazard Function</a></li>
  <li><a href="#integrated-hazard-function" id="toc-integrated-hazard-function" class="nav-link" data-scroll-target="#integrated-hazard-function"><span class="toc-section-number">4.1.4</span>  Integrated Hazard Function</a></li>
  <li><a href="#limits-worth-knowing" id="toc-limits-worth-knowing" class="nav-link" data-scroll-target="#limits-worth-knowing"><span class="toc-section-number">4.1.5</span>  Limits worth knowing</a></li>
  </ul></li>
  <li><a href="#chapter-2---distributions" id="toc-chapter-2---distributions" class="nav-link" data-scroll-target="#chapter-2---distributions"><span class="toc-section-number">4.2</span>  Chapter 2 - Distributions</a>
  <ul class="collapse">
  <li><a href="#exponential" id="toc-exponential" class="nav-link" data-scroll-target="#exponential"><span class="toc-section-number">4.2.1</span>  Exponential</a></li>
  <li><a href="#weibull" id="toc-weibull" class="nav-link" data-scroll-target="#weibull"><span class="toc-section-number">4.2.2</span>  Weibull</a></li>
  </ul></li>
  <li><a href="#chapter-2---life-tables" id="toc-chapter-2---life-tables" class="nav-link" data-scroll-target="#chapter-2---life-tables"><span class="toc-section-number">4.3</span>  Chapter 2 - Life Tables</a></li>
  <li><a href="#chapter-2.4---kaplan-meier" id="toc-chapter-2.4---kaplan-meier" class="nav-link" data-scroll-target="#chapter-2.4---kaplan-meier"><span class="toc-section-number">4.4</span>  Chapter 2.4 - Kaplan-Meier</a>
  <ul class="collapse">
  <li><a href="#no-censoring" id="toc-no-censoring" class="nav-link" data-scroll-target="#no-censoring"><span class="toc-section-number">4.4.1</span>  No Censoring</a></li>
  <li><a href="#with-censoring" id="toc-with-censoring" class="nav-link" data-scroll-target="#with-censoring"><span class="toc-section-number">4.4.2</span>  With Censoring</a></li>
  <li><a href="#calculating-median-st-with-km" id="toc-calculating-median-st-with-km" class="nav-link" data-scroll-target="#calculating-median-st-with-km"><span class="toc-section-number">4.4.3</span>  Calculating median S(t) with KM</a></li>
  <li><a href="#notes" id="toc-notes" class="nav-link" data-scroll-target="#notes"><span class="toc-section-number">4.4.4</span>  Notes</a></li>
  <li><a href="#exam-method" id="toc-exam-method" class="nav-link" data-scroll-target="#exam-method"><span class="toc-section-number">4.4.5</span>  Exam method</a></li>
  </ul></li>
  <li><a href="#chapter-2.5---parametric" id="toc-chapter-2.5---parametric" class="nav-link" data-scroll-target="#chapter-2.5---parametric"><span class="toc-section-number">4.5</span>  Chapter 2.5 - Parametric</a>
  <ul class="collapse">
  <li><a href="#using-r---exponetial" id="toc-using-r---exponetial" class="nav-link" data-scroll-target="#using-r---exponetial"><span class="toc-section-number">4.5.1</span>  Using R - Exponetial</a></li>
  <li><a href="#using-r---weibull" id="toc-using-r---weibull" class="nav-link" data-scroll-target="#using-r---weibull"><span class="toc-section-number">4.5.2</span>  Using R - Weibull</a></li>
  <li><a href="#workflow" id="toc-workflow" class="nav-link" data-scroll-target="#workflow"><span class="toc-section-number">4.5.3</span>  Workflow:</a></li>
  </ul></li>
  <li><a href="#chapter-3---two-sample" id="toc-chapter-3---two-sample" class="nav-link" data-scroll-target="#chapter-3---two-sample"><span class="toc-section-number">4.6</span>  Chapter 3 - Two Sample</a>
  <ul class="collapse">
  <li><a href="#log-rank-test" id="toc-log-rank-test" class="nav-link" data-scroll-target="#log-rank-test"><span class="toc-section-number">4.6.1</span>  Log Rank Test</a></li>
  <li><a href="#parametric" id="toc-parametric" class="nav-link" data-scroll-target="#parametric"><span class="toc-section-number">4.6.2</span>  Parametric</a></li>
  <li><a href="#mle-test" id="toc-mle-test" class="nav-link" data-scroll-target="#mle-test"><span class="toc-section-number">4.6.3</span>  MLE Test</a></li>
  <li><a href="#likelihood-ratio" id="toc-likelihood-ratio" class="nav-link" data-scroll-target="#likelihood-ratio"><span class="toc-section-number">4.6.4</span>  Likelihood Ratio</a></li>
  <li><a href="#survreg" id="toc-survreg" class="nav-link" data-scroll-target="#survreg"><span class="toc-section-number">4.6.5</span>  <code>Survreg</code></a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="survival.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Survival</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<p><strong>USE <code>ln</code> on your calculator!!!!!!!!!!!!!!!!</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><span class="math inline">\(\chi^2_{1, 0.95} = 3.84\)</span></p>
</blockquote>
<p>With survival analysis we aim to model lifetimes or populations. Survival analysis is unique as it aims to include censoring.</p>
<p>https://www.youtube.com/watch?v=7_XK7mGMm1E&amp;list=PLoROMvodv4rOzrYsAxzQyHb8n_RWNuS1e&amp;index=79</p>
<section id="chapter-1---intro" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="chapter-1---intro"><span class="header-section-number">4.1</span> Chapter 1 - Intro</h2>
<p>We are interested in two types of cencoring</p>
<ul>
<li>right : The failure occurs after a set time, died after trial</li>
<li>left : The failure occurs before the observations begin, died before trial starts</li>
</ul>
<p>The fundamental probaility theory required is as follows</p>
<section id="distribution-function" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="distribution-function"><span class="header-section-number">4.1.1</span> Distribution Function</h3>
<p>Let <span class="math inline">\(T\)</span> be the failure time, where <span class="math inline">\(T&gt;0\)</span>. Then as expected the distribution function is:</p>
<p><span class="math inline">\(F(t) = P(T\leq t)\)</span></p>
<p>And therefore the probability density is:</p>
<p><span class="math inline">\(f(t) = F'(t)\)</span></p>
<p>And so</p>
<p><span class="math inline">\(F(t) = \int_0^tf(u)du\)</span></p>
</section>
<section id="survivor-function" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="survivor-function"><span class="header-section-number">4.1.2</span> Survivor Function</h3>
<p>Generally we are interested in whether someone will survive longer than a certain time. So:</p>
<p><span class="math inline">\(S(t) = P(T\geq t) = 1 - F(t) = \int^{\infty}_t f(u) du\)</span></p>
<p>As it is linked to the distribution function we can therefore say</p>
<p><span class="math inline">\(f(t) = -S'(t)\)</span></p>
</section>
<section id="hazard-function" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="hazard-function"><span class="header-section-number">4.1.3</span> Hazard Function</h3>
<p>The risk of death at time <span class="math inline">\(t\)</span> given survival to time <span class="math inline">\(t\)</span>. Or the instantaenous risk of death at time <span class="math inline">\(t\)</span></p>
<p><span class="math inline">\(h(t) = \frac{f(t)}{S(t)}\)</span></p>
</section>
<section id="integrated-hazard-function" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="integrated-hazard-function"><span class="header-section-number">4.1.4</span> Integrated Hazard Function</h3>
<p><span class="math inline">\(H(t) = \int^{t}_0 h(u) du = -log(S(t))\)</span></p>
<p>So</p>
<p><span class="math inline">\(S(t) = e^{\left(-H(t)\right)}\)</span></p>
<p>and</p>
<p><span class="math inline">\(f(t) = h(t)e^{\left(-H(t)\right)}\)</span></p>
</section>
<section id="limits-worth-knowing" class="level3" data-number="4.1.5">
<h3 data-number="4.1.5" class="anchored" data-anchor-id="limits-worth-knowing"><span class="header-section-number">4.1.5</span> Limits worth knowing</h3>
<p><span class="math inline">\(f(t) = lim_{h \rightarrow 0 } \frac{P(t &lt; T &lt; t+h)}{h}\)</span></p>
<p>and</p>
<p><span class="math inline">\(h(t) = lim_{h \rightarrow 0 } \frac{P(t \leq T &lt; t+h | T \geq t)}{h}\)</span></p>
</section>
</section>
<section id="chapter-2---distributions" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="chapter-2---distributions"><span class="header-section-number">4.2</span> Chapter 2 - Distributions</h2>
<section id="exponential" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="exponential"><span class="header-section-number">4.2.1</span> Exponential</h3>
<p>The only distribution with a constant hazard function.</p>
<p><span class="math inline">\(T_i \sim Exp(\lambda, \gamma)\)</span></p>
<table class="table">
<thead>
<tr class="header">
<th>Property</th>
<th>equation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(f(t)\)</span></td>
<td><span class="math inline">\(\lambda e^{-\lambda t}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(F(t)\)</span></td>
<td><span class="math inline">\(1 - e^{-\lambda t}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(S(t)\)</span></td>
<td><span class="math inline">\(e^{-\lambda t}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(h(t)\)</span></td>
<td><span class="math inline">\(\lambda\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="weibull" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="weibull"><span class="header-section-number">4.2.2</span> Weibull</h3>
<p>The weibull can vary by implementation <code>survreg</code> uses the following implementation</p>
<p><span class="math inline">\(T_i \sim Weibull(\lambda, \gamma)\)</span></p>
<p>Properties should be given, <strong>TO BE VERIFIED</strong></p>
<p>In this course:</p>
<ul>
<li><span class="math inline">\(\lambda\)</span> is the shape</li>
<li><span class="math inline">\(\gamma\)</span> is the rate</li>
</ul>
<p>It is extremely flexible, but can become unstable near <span class="math inline">\(\gamma = 1\)</span>. From <span class="math inline">\(\gamma\)</span> we know the following:</p>
<ul>
<li><span class="math inline">\(\gamma = 1\)</span> - Constant Hazard, becomes the exponential</li>
<li><span class="math inline">\(\gamma &gt; 1\)</span> - Hazard INCREASES with time</li>
<li><span class="math inline">\(\gamma &lt; 1\)</span> - Hazard DECREASES with time</li>
</ul>
<p><strong>TODO - Add plot to get a feel for various hazrds, etc</strong></p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="fl">0.1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>s_t <span class="op">=</span> stats.expon(<span class="dv">0</span>,<span class="dv">10</span>).sf(xs)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>f_t <span class="op">=</span> stats.expon(<span class="dv">0</span>,<span class="dv">10</span>).pdf(xs)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>plt.plot(xs,s_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="survival_files/figure-html/cell-2-output-1.png" width="571" height="411"></p>
</div>
</div>
</section>
</section>
<section id="chapter-2---life-tables" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="chapter-2---life-tables"><span class="header-section-number">4.3</span> Chapter 2 - Life Tables</h2>
<p>See notes - Two example type to be practiced exhaustively (No loss and loss to follow up)</p>
<p>Lifetables tabulate death rates over a period of time. They are useful non-parametric summaries and help to inform which parametric models might be sensible.</p>
<p>In the loss to follow up we assume in this course that:</p>
<ul>
<li><span class="math inline">\(p_x\)</span> and <span class="math inline">\(q_x\)</span> are constant over a time period, this is reasonable if short</li>
<li>We assume those who withdraw have the same probability of dieing as those who don’t</li>
<li>We assume withdrawls are evenly spaced through the year</li>
</ul>
<p>TODO: Finalise life tables with method.</p>
</section>
<section id="chapter-2.4---kaplan-meier" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="chapter-2.4---kaplan-meier"><span class="header-section-number">4.4</span> Chapter 2.4 - Kaplan-Meier</h2>
<p>Life tables are just summaries. They result in a loss of alot of information as the bin dates. Kaplan-Meir is more useful if you have access to the raw data.</p>
<p>The full name of this chapter is the “Kaplan-Meier Product Limit Estimate of S(t)”</p>
<blockquote class="blockquote">
<p>This can be practised endlessly using <code>survfit</code></p>
</blockquote>
<section id="no-censoring" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="no-censoring"><span class="header-section-number">4.4.1</span> No Censoring</h3>
<p>Note - The somewhat obscure inclusion of at risk becomes clear when you include censored values.</p>
<p>If there are <span class="math inline">\(n\)</span> observed times to failures (<span class="math inline">\(t_i\)</span>) we can order the times (provided there are k distinct). So</p>
<p><span class="math inline">\(t_1, t_2, ... t_n\)</span> becomes <span class="math inline">\(t_{(1)} &lt; t_{(2)} &lt; ... &lt; t_{(k)}\)</span>. If <span class="math inline">\(d_i\)</span> is the number of deaths at time <span class="math inline">\(t_{(i)}\)</span> then :</p>
<p><span class="math inline">\(\sum_{i=1}^k d_i = n\)</span></p>
<p>If we knwo this then we can estimate the CDF by:</p>
<p><span class="math inline">\(\hat{F}(t) = \text{Proprtion of lifetimes that are} &lt; t\)</span></p>
<p>So if we are given a time <span class="math inline">\(t\)</span> to calculate we can use the following equation to approximate:</p>
<p><span class="math inline">\(\frac{1}{n} \sum^{s}_{i=1}d_i\)</span> where <span class="math inline">\(t_s\leq t \leq t_{s+1}\)</span></p>
<p>So as <span class="math inline">\(\hat{S}(t) = 1 - \hat{F}(t)\)</span> we can easily calc by</p>
<p><span class="math inline">\(1 - \frac{1}{n} \sum^{s}_{i=1}d_i = \frac{n - \sum^{s}_{i=1}d_i }{n}\)</span></p>
<p>A useful trick however is to consider <span class="math inline">\(r_j\)</span> those “at risk” (those who are still alive) just before time <span class="math inline">\(t_j\)</span>. Just before <span class="math inline">\(t_j\)</span> we know that <span class="math inline">\(r_{j+1} = r_j - d_j\)</span>. In lay terms the number at risk next is the number who were previoulsy at risk less those who just died.</p>
<p>By a telescoping series like effect it can be shown that (notice trailing numerator cancel leading denominator)</p>
<p><span class="math inline">\(\hat{S}(t) = \frac{n-d_1}{n} \times \frac{n-d_1 - d_2}{n - d_1} \times \frac{n-d_1 - d_2- d_3}{n - d_1 - d_2} \times ... \times \frac{n - d_1 - ... - d_s}{n - d_1 - ... - d_{s-1}}\)</span></p>
<p>At risk <span class="math inline">\(r\)</span> can now be incorperated. as</p>
<p><span class="math inline">\(\hat{S}(t) = (1 - \frac{d_1}{r_1}) \times (1 - \frac{d_2}{r_2}) \times ... \times (1 - \frac{d_s}{r_s})\)</span></p>
<p>Simuplifying by notation therefore:</p>
<p><span class="math inline">\(\hat{S}(t) = \prod^s_{j=1}( 1 - \frac{d_j}{r_j})\)</span> for <span class="math inline">\(t_s\leq t &lt; t_{s+1}\)</span></p>
<p>It must hold that <span class="math inline">\(s\geq 1\)</span> and anything before then is assume to equal 1. If everyone dies then the KP curve will go to zero.</p>
</section>
<section id="with-censoring" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="with-censoring"><span class="header-section-number">4.4.2</span> With Censoring</h3>
<p>Because we have included the at risk aspecty, censoring is treated in a very similar way except the at risk aspect is modified.</p>
<p>To calculate those at risk just before time <span class="math inline">\(t\)</span> we need to know who was cencosred. We introduce an <span class="math inline">\(I_j\)</span> term which is the number of people censored in the time interval <span class="math inline">\(t_{j-1} \leq t &lt; t_j\)</span></p>
<p><span class="math inline">\(r_1 = n - I_1\)</span></p>
<p>More generally</p>
<p><span class="math inline">\(r_j = r_{j-1} - d_{j-1} - I_j\)</span></p>
</section>
<section id="calculating-median-st-with-km" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="calculating-median-st-with-km"><span class="header-section-number">4.4.3</span> Calculating median S(t) with KM</h3>
<p>The median survival time is the smallest value of time where the survivor function takes a value of 0.5 or less.</p>
<p>So for instance in your Kaplan-Meier table you have a something like this</p>
<table class="table">
<thead>
<tr class="header">
<th>time</th>
<th>S(t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4</td>
<td>0.55</td>
</tr>
<tr class="even">
<td>8</td>
<td>0.47</td>
</tr>
</tbody>
</table>
<p>Then the median survival time is 8</p>
</section>
<section id="notes" class="level3" data-number="4.4.4">
<h3 data-number="4.4.4" class="anchored" data-anchor-id="notes"><span class="header-section-number">4.4.4</span> Notes</h3>
<ul>
<li>KM relies on short intervals for recording death, if not completely continuous. It will not work for things like lifetables</li>
<li>If uncencorsed <span class="math inline">\(I_j\)</span> is always 0 so you get the same thing again</li>
<li>If the last observation(s) are censcored then the KM curve never reaches 0 but carries on forever. Obviously this isn’t real and so becomes biased if the last observation(s) are censored.</li>
<li>Greenwoods provides a formula for sampling error <span class="math inline">\(var(\hat{S}(t)) = (\hat{S}(t))^2 \sum^s_{j=1} \frac{d_j}{r_j(r_j - d_j)}\)</span> for <span class="math inline">\(t_s\leq t \leq t_{s+1}\)</span></li>
<li>Hazard can also be calculated as <span class="math inline">\(\hat{H}(t) = -log\hat{S}(t)\)</span>. A simplae approiximation for hazard can be shown to be <span class="math inline">\(H(t) \approx \sum_{j-1}^s\frac{d_j}{r_j}\)</span></li>
</ul>
</section>
<section id="exam-method" class="level3" data-number="4.4.5">
<h3 data-number="4.4.5" class="anchored" data-anchor-id="exam-method"><span class="header-section-number">4.4.5</span> Exam method</h3>
<blockquote class="blockquote">
<p>This can be practised endlessly using <code>survfit</code></p>
</blockquote>
<p>TODO: COMPLETE THIS AFTER SIME PRACTICE</p>
<ol type="1">
<li>Create a j col from 0 …. to number of unique death timestamp, 0 is a unique time too.</li>
<li>List all unique deaths in <span class="math inline">\(t_{(j)}\)</span> column. DO NOT INCLUDE CENSOR TIMES. 0 is a valid time.</li>
<li>Leave 0 row blank with exception of column, set that to 1.</li>
<li>Make censor column (<span class="math inline">\(I_j\)</span>) denotes all censored values in the preceding window <span class="math inline">\(t_{j-1} \leq t &lt; t_j\)</span></li>
<li>create deaths column <span class="math inline">\(d_j\)</span> at time <span class="math inline">\(t_j\)</span></li>
<li>Create an at risk column. This is the most complicated, <span class="math inline">\(r_j = r_{j-1} - d_{j-1} - I_j\)</span></li>
<li>Calultate <span class="math inline">\(1 - \frac{d_j}{r_j}\)</span></li>
<li><span class="math inline">\(\hat{S}(t)\)</span> is the product of 7</li>
<li>Create a <span class="math inline">\(t\)</span> column much like a CDF where <span class="math inline">\(0 \leq t &lt; d_1\)</span> (intervals are critical to marks/understanding)</li>
<li>first <span class="math inline">\(t_j\)</span> to be less than 0.5 is the median!</li>
</ol>
<blockquote class="blockquote">
<p>remember <span class="math inline">\(r_1 = n - I_1\)</span></p>
</blockquote>
<blockquote class="blockquote">
<p>If in doubt think hard about <span class="math inline">\(\leq t &lt;\)</span> for placing deaths, logic. In the notes we put it last, I think it should almost go first.</p>
</blockquote>
<blockquote class="blockquote">
<p>Treat groups seperately, creating different tables for each</p>
</blockquote>
<blockquote class="blockquote">
<p>Make sure you put 0.5 line on KM plot to indicate median</p>
</blockquote>
</section>
</section>
<section id="chapter-2.5---parametric" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="chapter-2.5---parametric"><span class="header-section-number">4.5</span> Chapter 2.5 - Parametric</h2>
<p>TODO : In this I largely gloss over the likelihood stuff. It feels unlikely it will be examined and I will retun if time.</p>
<p>This chapter assumes an exponetial distribution <span class="math inline">\(T \sim Exp(\lambda)\)</span> is being used.</p>
<p>When doing likelihood for uncensored data you follwo the usual path of finding the Likelihood by multiplying through, get log likelihood if convinient and differentiating with respect to the paramater. So</p>
<p><span class="math inline">\(L(\lambda ; t_1, t_2 ... t_n) = \prod^n_{i=1}f(t_i)\)</span></p>
<p>In the censored case however this becomes a little more complicated. You cannot just multiply by the desnities as you do not know the density for the censored values.</p>
<p>If we observed a death then <span class="math inline">\(f(t)\)</span> contributes to the likelihood. However if we do not observed the death <span class="math inline">\(t_i &gt; c_i\)</span> then we say that we know they survived longer than some time so <span class="math inline">\(P(T &gt; c_i) = S(c_i)\)</span>. And this contributes to the likelihood.</p>
<p>By combining density and survivor functions and applying the indicator 0=censor, 1=death. The following form of the likelihood can be created:</p>
<p>$L() = _{i=1}^n f(t_i)^{_i}S(c_i)^{1-_i} = $</p>
<p><span class="math inline">\(L(\lambda) = \prod_{i=1}^n [\lambda e^{-\lambda t_i}]^{\delta_i}[e^{-\lambda c_i}]^{1-\delta_i}\)</span></p>
<p>It can then be shown that:</p>
<p><span class="math inline">\(\hat{\lambda} = \frac{\sum^n_{i=1} \delta_i}{\sum^n_{i=1}(t_i\delta_i +(1-\delta_i)c_i)}\)</span></p>
<p>And</p>
<p><span class="math inline">\(var(\hat{\lambda}) \approx \frac{\hat{\lambda}^2}{\sum^n_{i=1} \delta_i}\)</span></p>
<p>By asymptopic normality of the MLE the 95% CI is <span class="math inline">\(\hat{\lambda}\pm 1.96\sqrt{var(\hat{\lambda}}\)</span></p>
<p>For the exponential we calculate the mean by <span class="math inline">\(\frac{1}{var(\hat{\lambda})}\)</span> and the variance of this can be shown to be</p>
<p><span class="math inline">\(var(\hat{\mu}) = \frac{\hat{\mu}^2}{\sum_{i=1}^n \delta_i}\)</span></p>
<p>TODO: What is the value in learning equation 56/61 with exp denom. TODO: RAndom censoring, log normal and others (2.5.6)</p>
<section id="using-r---exponetial" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="using-r---exponetial"><span class="header-section-number">4.5.1</span> Using R - Exponetial</h3>
<p>The exponetial model can be fitted in r with <code>survreg</code>, where <code>dist='exponential'</code>.</p>
<p>For the MLE of <span class="math inline">\(\hat{\lambda}\)</span> you take <span class="math inline">\(exp(-\beta_0)\)</span> assuming no covariates eg <code>time ~ 1</code>. The easiest way to get the CI is to apply +/- 1.96 standard error to beta pre exponent. This will give some minor disagreement though to the division by death count method.</p>
<blockquote class="blockquote">
<p><span class="math inline">\(\hat{\lambda} = exp(-\hat{\beta_0} \pm 1.96\times se(\hat{\beta_0}))\)</span></p>
</blockquote>
</section>
<section id="using-r---weibull" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="using-r---weibull"><span class="header-section-number">4.5.2</span> Using R - Weibull</h3>
<p>Under the weibull again <span class="math inline">\(\hat{\lambda} = exp(-\hat{\beta_0} \pm 1.96\times se(\hat{\beta_0}))\)</span> and <span class="math inline">\(\hat{\gamma} = \frac{1}{\text{scale}}\)</span></p>
<p>The weibull is summarised in our work as <span class="math inline">\(T \sim Weibull(\lambda, \gamma)\)</span></p>
<p>When <span class="math inline">\(\gamma = 1\)</span> we are left with the exponential distribution.</p>
</section>
<section id="workflow" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3" class="anchored" data-anchor-id="workflow"><span class="header-section-number">4.5.3</span> Workflow:</h3>
<ol type="1">
<li>fit a kaplan-meier. Is the decay expoenntial? then exp could make sense</li>
</ol>
</section>
</section>
<section id="chapter-3---two-sample" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="chapter-3---two-sample"><span class="header-section-number">4.6</span> Chapter 3 - Two Sample</h2>
<p>Kaplan-Meier is just a visual aid, we need to look at tests</p>
<section id="log-rank-test" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="log-rank-test"><span class="header-section-number">4.6.1</span> Log Rank Test</h3>
<p>Non-parametric.</p>
<p><span class="math display">\[ H_0 : S_1(t) = S_2(t)\]</span></p>
<p><span class="math display">\[ H_A : S_1(t) \neq S_2(t)\]</span></p>
<p><span class="math inline">\(H_A\)</span> is for some <span class="math inline">\(t\)</span></p>
<p>Steps:</p>
<ol type="1">
<li>Create a table</li>
<li>create an <span class="math inline">\(i\)</span> column for 1,2,..n</li>
<li>create a <span class="math inline">\(t_i\)</span> column and list all the times of deaths only</li>
<li>Create an <span class="math inline">\(r_{1,i}\)</span> and <span class="math inline">\(r_{2,i}\)</span> for at risk (At risk for a time includes those who died at that time and all future censorees)</li>
<li>Sum <span class="math inline">\(r_{1,i}\)</span> and <span class="math inline">\(r_{2,i}\)</span> to get <span class="math inline">\(r_i\)</span> (row wise)</li>
<li>Create an <span class="math inline">\(d_{1,i}\)</span> and <span class="math inline">\(d_{2,i}\)</span> for death counts at the times</li>
<li>Sum the deaths to get <span class="math inline">\(d_i\)</span></li>
<li>Sum down death column to get observed <span class="math inline">\(O_1\)</span> and <span class="math inline">\(O_2\)</span></li>
<li>Calc <span class="math inline">\(e_{1,i} = (\frac{r_{1,i}}{r_i})d_i\)</span> and <span class="math inline">\(e_{2,i}\)</span></li>
<li>Sum the <span class="math inline">\(e_{1,i}\)</span> and <span class="math inline">\(e_{2,i}\)</span> to get <span class="math inline">\(E_1\)</span> and <span class="math inline">\(E_2\)</span></li>
<li>Calculate using below equation</li>
</ol>
<p><span class="math display">\[ LR = \frac{(O_1 - E_1)^2}{E_1} + \frac{(O_2 - E_2)^2}{E_2} \sim \chi^2_{1}\]</span></p>
<p>To perform the logrank in r perform the following <code>survdiff(formula = 'time ~ treatment')</code></p>
</section>
<section id="parametric" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="parametric"><span class="header-section-number">4.6.2</span> Parametric</h3>
<p>There are two types of parametric methods of interest MLE test and Likelihood ratio</p>
</section>
<section id="mle-test" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="mle-test"><span class="header-section-number">4.6.3</span> MLE Test</h3>
<p>Effectively looks at the paramters as normally distributed (though any test, distribution is applicable). Then performs standard tests upon them. So in the case of lambda, given it is normally distributed as an estimator.</p>
<p><span class="math inline">\(\frac{\hat{\lambda}_1 - \hat{\lambda}_2}{\sqrt{\frac{\hat{\lambda}_1^2}{\Delta_1}-\frac{\hat{\lambda}_2^2}{\Delta_2}}} \sim N(0,1)\)</span></p>
<p>Here <span class="math inline">\(\Delta\)</span> is the number of deaths and <span class="math inline">\(\hat{\lambda}\)</span> is the number of deaths over total time (death and censor).</p>
</section>
<section id="likelihood-ratio" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4" class="anchored" data-anchor-id="likelihood-ratio"><span class="header-section-number">4.6.4</span> Likelihood Ratio</h3>
<p>In formula sheet</p>
<p>TODO: run through the proof</p>
</section>
<section id="survreg" class="level3" data-number="4.6.5">
<h3 data-number="4.6.5" class="anchored" data-anchor-id="survreg"><span class="header-section-number">4.6.5</span> <code>Survreg</code></h3>
<p>From survreg we can use the output of a two factor analysis to easily do a MLE test by taking the parameter and covariance matrix.</p>
<p>For LRT look at the following line near the bottom for the p-value.</p>
<p>Chisq=1.2 on 1 degrees of freedom , p=0.27</p>
<p>TODO: missing formula for median exponential</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Clinical Trials.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Clinical Trials</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./survival_regression.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Survival</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>