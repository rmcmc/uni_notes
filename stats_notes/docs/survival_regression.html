<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>stats_notes - 6&nbsp; Survival</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./linear_models.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Survival</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">stats_notes</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Summary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Clinical Trials.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Chapter 1 - Intro</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Survival</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear_models.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival_regression.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Survival</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#aft" id="toc-aft" class="nav-link active" data-scroll-target="#aft"><span class="toc-section-number">6.1</span>  AFT</a>
  <ul class="collapse">
  <li><a href="#two-group-example" id="toc-two-group-example" class="nav-link" data-scroll-target="#two-group-example"><span class="toc-section-number">6.1.1</span>  Two Group Example</a></li>
  <li><a href="#generalising-to-two-groups" id="toc-generalising-to-two-groups" class="nav-link" data-scroll-target="#generalising-to-two-groups"><span class="toc-section-number">6.1.2</span>  Generalising to two groups</a></li>
  <li><a href="#exponetial-case" id="toc-exponetial-case" class="nav-link" data-scroll-target="#exponetial-case"><span class="toc-section-number">6.1.3</span>  Exponetial Case</a></li>
  <li><a href="#weibull" id="toc-weibull" class="nav-link" data-scroll-target="#weibull"><span class="toc-section-number">6.1.4</span>  Weibull</a></li>
  <li><a href="#testing-exp-vs-weibull" id="toc-testing-exp-vs-weibull" class="nav-link" data-scroll-target="#testing-exp-vs-weibull"><span class="toc-section-number">6.1.5</span>  Testing Exp vs Weibull</a></li>
  </ul></li>
  <li><a href="#proportional-hazards" id="toc-proportional-hazards" class="nav-link" data-scroll-target="#proportional-hazards"><span class="toc-section-number">6.2</span>  Proportional Hazards</a>
  <ul class="collapse">
  <li><a href="#why-is-it-called-proportional-hazards" id="toc-why-is-it-called-proportional-hazards" class="nav-link" data-scroll-target="#why-is-it-called-proportional-hazards"><span class="toc-section-number">6.2.1</span>  Why is it called proportional hazards</a></li>
  <li><a href="#advantagedisadvantage" id="toc-advantagedisadvantage" class="nav-link" data-scroll-target="#advantagedisadvantage"><span class="toc-section-number">6.2.2</span>  Advantage/Disadvantage</a></li>
  <li><a href="#estimating-beta" id="toc-estimating-beta" class="nav-link" data-scroll-target="#estimating-beta"><span class="toc-section-number">6.2.3</span>  Estimating <span class="math inline">\(\beta\)</span></a></li>
  <li><a href="#intrepreting-r-output" id="toc-intrepreting-r-output" class="nav-link" data-scroll-target="#intrepreting-r-output"><span class="toc-section-number">6.2.4</span>  Intrepreting R output</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="survival_regression.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Survival</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The first thing we are interested in is setting a baseline for the explanatory variables <span class="math inline">\(\textbf{x}\)</span>. Where <span class="math inline">\(\textbf{x}\)</span> becomes the zero vector <span class="math inline">\(\textbf{0}\)</span>. Eg. <span class="math inline">\(\textbf{x} = (0,0,0...,0)\)</span>.</p>
<p>It is very common for age to be standardised around some age of interest. Eg 50, so all ages would be given as 5, -10, etc which equates to 55 and 40.</p>
<p>The two common methods are :</p>
<ul>
<li>Accelarated Failure Time (AFT)</li>
<li>Proportional Hazards (PH)</li>
</ul>
<section id="aft" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="aft"><span class="header-section-number">6.1</span> AFT</h2>
<section id="two-group-example" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="two-group-example"><span class="header-section-number">6.1.1</span> Two Group Example</h3>
<p>In the simplests case we model survival times <span class="math inline">\(T\)</span> as a random variable. But with two groups we want to model them both as seperate RVs. Where the baseline RV is <span class="math inline">\(T_0\)</span> and the treatment (or other covariate) is given by <span class="math inline">\(T_1\)</span>. As we now have times we can therefore model survivor functions <span class="math inline">\(S\)</span>. However in AFTs we don’t want <span class="math inline">\(S_0\)</span> and <span class="math inline">\(S_1\)</span> we want a single survivor function that is scaled.</p>
<p>We therefore look to the following:</p>
<p><span class="math inline">\(\text{Group 0 :   } S(t ; x_i=0) = P(T_0&gt;t) = S_0(t))\)</span> <span class="math inline">\(\text{Group 1 :   } S(t ; x_i=1) = P(T_1&gt;t) = P(\frac{T_0}{\psi}&gt; t) = P(T_0&gt;\psi t) = S_0(\psi t))\)</span></p>
<p>So <span class="math inline">\(\psi\)</span> “accelrates time” and hence AFT and so the RVs are related by <span class="math inline">\(T_1 = \frac{T_0}{\psi}\)</span> and so <span class="math inline">\(S_1(t) = S_0(\psi t)\)</span>.</p>
<p>Thinking back to graphing, any multiplier of a function value is a stretch in x, whose magnitude is the reciprical. So a <span class="math inline">\(\psi &gt;1\)</span> will shrink survival time by <span class="math inline">\(\frac{1}{\psi}\)</span> and a <span class="math inline">\(\psi &lt;1\)</span> will extend survival time.</p>
<p>So <span class="math inline">\(\psi &gt;1\)</span> accelrates time for the patient (so they are more likely to die faster). Less than one Deaccelerates!</p>
<blockquote class="blockquote">
<p>Scale factor is <span class="math inline">\(\frac{1}{\psi}\)</span> , less than 1 means better survival times for the patient</p>
</blockquote>
<p>So <span class="math inline">\(\psi\)</span> is a function of <span class="math inline">\(\textbf{x}\)</span>, all of our covariates, which determine the “acceleration”</p>
</section>
<section id="generalising-to-two-groups" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="generalising-to-two-groups"><span class="header-section-number">6.1.2</span> Generalising to two groups</h3>
<p>Instead of now having a <span class="math inline">\(\psi\)</span> to turn on and off we now require <span class="math inline">\(\psi(\textbf{x})\)</span> so that we can create a scaling factor for each individual. We therefore assume that (Where <span class="math inline">\(S_0\)</span> is <span class="math inline">\(S(t)\)</span> at the baseline consitions where <span class="math inline">\(\textbf{x} = \textbf{0}\)</span>):</p>
<p><span class="math inline">\(S(t;\textbf{x}) = S_0(t\psi(\textbf{x}))\)</span></p>
<p>From this it can be shown that the following are true:</p>
<p><span class="math inline">\(f(t;\textbf{x}) = f_0(t\psi(\textbf{x}))\psi(\textbf{x})\)</span></p>
<p><span class="math inline">\(h(t;\textbf{x}) = h_0(t\psi(\textbf{x}))\psi(\textbf{x})\)</span></p>
<p>This can be derived by showing that that <span class="math inline">\(t\)</span> being multiplie by <span class="math inline">\(\psi\)</span> and has <span class="math inline">\(S_0\)</span> applied to it as a function. We know the relationship between the survival function and the density fuinction. <span class="math inline">\(S(t) = 1- F(t)\)</span> differentiatiing we get negative density function. A function of a function, means that we need to use the chain rul and therefore gets the above. From the desnity we can get the hazard. TODO : Write out derivation. More details can be found at 25mins, 8/12.</p>
<p>So again: <span class="math inline">\(T = \frac{T_0}{\psi(\textbf{x})}\)</span></p>
<p>We are yet to define <span class="math inline">\(\psi(\textbf{x})\)</span> but tow conditions must be met:</p>
<ul>
<li><span class="math inline">\(\psi(\textbf{x})\geq 0\)</span>, so cannot have a negative time</li>
<li><span class="math inline">\(\psi(\textbf{0}) = 1\)</span>, so that the basline has no strethcing effects.</li>
</ul>
<p>From this a naturual choice is (it could be any functiion though):</p>
<p><span class="math inline">\({\psi(\textbf{x})} = \exp(-\beta'\textbf{x})\)</span></p>
<p>This gives us our parameters, but excludes the intercept terms. Recalling <span class="math inline">\(T = \frac{T_0}{\psi(\textbf{x})}\)</span> then</p>
<p><span class="math inline">\(E[T] = \exp(\beta'\textbf{x})E[T_0]\)</span></p>
<p>If <span class="math inline">\(\beta_i x_i\)</span> is positive then the expected survival time increases (good fro patient)</p>
</section>
<section id="exponetial-case" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="exponetial-case"><span class="header-section-number">6.1.3</span> Exponetial Case</h3>
<p>Using the above we can therefore start to create an exponential AFT. We already know that for the exponential distribution:</p>
<table class="table">
<colgroup>
<col style="width: 35%">
<col style="width: 35%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>Property</th>
<th>equation</th>
<th>AFT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(S(t)_0\)</span></td>
<td><span class="math inline">\(e^{-\lambda t}\)</span></td>
<td><span class="math inline">\(S(t;\textbf{x}) = \exp(-\lambda t e^{-\beta'\textbf{x}})\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(h(t)_0\)</span></td>
<td><span class="math inline">\(\lambda\)</span></td>
<td><span class="math inline">\(\lambda e^{-\beta'\textbf{x}}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(f(t)_0\)</span></td>
<td><span class="math inline">\(\lambda e^{-\lambda t}\)</span></td>
<td><span class="math inline">\(\lambda e^{-\beta'\textbf{x}} \exp(-\lambda t e^{-\beta'\textbf{x}})\)</span></td>
</tr>
</tbody>
</table>
<p>So if <span class="math inline">\(\textbf{x}_i\)</span> is a p dimensional vector of explanatory variables then we ca n by MLE find p+1 parameters <span class="math inline">\((\lambda, \beta_1, \beta_2...\beta_p)\)</span>.</p>
<p>MLE is found by usual method, get derivative, set to 0, solve iteratively. <span class="math inline">\(\hat{\lambda}\)</span> and <span class="math inline">\(\hat{\beta}\)</span> are found any by the asymptopic properties of the MLE we know that:</p>
<p><span class="math inline">\(\hat{\lambda} \sim N(\lambda, \text{Var}(\hat{\lambda}))\)</span></p>
<p>We can obtain <span class="math inline">\(\text{Var}(\hat{\lambda}))\)</span> from the expected/observed stuff covered in chapter 3 (TODO: find this out!)</p>
<section id="final-model" class="level4" data-number="6.1.3.1">
<h4 data-number="6.1.3.1" class="anchored" data-anchor-id="final-model"><span class="header-section-number">6.1.3.1</span> Final model</h4>
<p>If we are extra explicit with <span class="math inline">\(\lambda_0\)</span> we can say that <span class="math inline">\(T_0 \sim \text{exp}(\lambda_0)\)</span> so <span class="math inline">\(S(t;\textbf{x}) = \exp(-\lambda_0 t e^{-\beta'\textbf{x}})\)</span>. Then it is more convinient to say that <span class="math inline">\(\lambda_0 = \exp(-\beta_0)\)</span></p>
<p>Then we can lift the <span class="math inline">\(\lambda\)</span> into the exponent. Thus:</p>
<p><span class="math inline">\(S(t;\textbf{x}) = \exp(- t e^{(-(\beta_0 + \beta_1\textbf{x}_1 + \beta_2\textbf{x}_2 ...))})\)</span></p>
<p>This then looks alot like <span class="math inline">\(e^{-t\lambda}\)</span> but we now have <span class="math inline">\(e^{-t\lambda(\textbf{x})}\)</span> and so we can conclude:</p>
<p><span class="math inline">\(T \sim exp(\lambda(\textbf{x}))\)</span></p>
<p>So <span class="math inline">\(\lambda(x) = exp(-(\beta_0 + \beta_1\textbf{x}_1 + \beta_2\textbf{x}_2 ...))\)</span></p>
<p>And from standard properties we therefor know that <span class="math inline">\(E[T] = \frac{1}{\lambda(\textbf{x})}\)</span> and therefore thre MLE fo the mean is:</p>
<p><span class="math inline">\(\frac{1}{\hat{\lambda}(x)} = exp(\beta_0 + \beta_1\textbf{x}_1 + \beta_2\textbf{x}_2 ...)\)</span></p>
<blockquote class="blockquote">
<p><span class="math inline">\(\lambda_0 = \exp(-\beta_0)\)</span> or <span class="math inline">\(\lambda_0 = \exp(-\text{Intercept})\)</span> in <code>survreg</code></p>
</blockquote>
</section>
</section>
<section id="weibull" class="level3" data-number="6.1.4">
<h3 data-number="6.1.4" class="anchored" data-anchor-id="weibull"><span class="header-section-number">6.1.4</span> Weibull</h3>
<p>In R we use the following implementation of the weibull distribution, it’s survivor function is as follows:</p>
<p><span class="math inline">\(S(t) = \exp{\(\lambda t )^{\gamma}}\)</span></p>
<p>SO repeating the same steps as for the exponential we can say that the RV <span class="math inline">\(T_0\)</span> is:</p>
<p>$T_0 (_0, )</p>
<p>Add the scalling factor:</p>
<p><span class="math inline">\(S(t;\textbf{x}) = exp(-(\lambda t e^{-\beta ' \textbf{x}})^{\gamma})\)</span></p>
<p>Agian let <span class="math inline">\(\lambda_0 = exp(-\beta_0)\)</span></p>
<p><span class="math inline">\(S(t;\textbf{x}) = exp(-( t e^{-(\beta_0 + \beta_1 x_1 + \beta_2 x_2 ...)})^{\gamma})\)</span></p>
<p>So <span class="math inline">\(\lambda(\textbf{x}) = e^{-(\beta_0 + \beta_1 x_1 + \beta_2 x_2 ...)}\)</span></p>
<p>The rate <span class="math inline">\(\gamma\)</span> is unaffected by the covariates, so only <span class="math inline">\(\lambda(\textbf{x})\)</span> is required.</p>
</section>
<section id="testing-exp-vs-weibull" class="level3" data-number="6.1.5">
<h3 data-number="6.1.5" class="anchored" data-anchor-id="testing-exp-vs-weibull"><span class="header-section-number">6.1.5</span> Testing Exp vs Weibull</h3>
<p>The defualt distribution in <code>survreg</code> is the weibull.</p>
<p>It will also report the log(scale) in the summary. This is a test that <span class="math inline">\(H_0 \text{ : log(scale)} = 0\)</span>, basically whether <span class="math inline">\(\gamma = 1\)</span> as <span class="math inline">\(\gamma = \frac{1}{scale}\)</span>. If we don’t reject probably better to stick with the exponential as it is the simpler model.</p>
</section>
</section>
<section id="proportional-hazards" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="proportional-hazards"><span class="header-section-number">6.2</span> Proportional Hazards</h2>
<p>In AFTs we were concerned with scaling time by <span class="math inline">\(S(t;\textbf{x}) = S_0(t\psi(\textbf{x}))\)</span>, so survivor function depends on <span class="math inline">\(\textbf{x}\)</span>.</p>
<p>In proportional hazards, the hazard function depends on through the hazard function so. Agian we consider the baseline <span class="math inline">\(h_0\)</span> where the covariates <span class="math inline">\(\textbf{x}\)</span> are the zero vector <span class="math inline">\(\textbf{0}\)</span></p>
<p><span class="math inline">\(h(t;\textbf{x}) = \psi(\textbf{x};\beta) h_0(t)\)</span></p>
<p>So again it’s just deviation from the baseline. Again therefore we need a sensible function. There is only one constraint here and that is <span class="math inline">\(\psi(\textbf{x}=0;\beta)\)</span> must equal 1. So</p>
<p><span class="math inline">\(\psi(\textbf{x};\beta) = e^{\beta'\textbf{x}}\)</span></p>
<p>Note that in AFT the exponent is negative, whereas it is positive here. We could use negative in AFT to make it consistent with the other parameter estimates, eg lambda as the intercept. A negative here would make it harder to interpret the hazards.</p>
<section id="why-is-it-called-proportional-hazards" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="why-is-it-called-proportional-hazards"><span class="header-section-number">6.2.1</span> Why is it called proportional hazards</h3>
<p>The hazard ratio is independent of time. As the baseline hazard cancels we are left with a time invariant ratio.</p>
<p><span class="math inline">\(\frac{h(t;x_1)}{h(t;x_2)} = \frac{h_0(t)e^{\beta_1 x_1}}{h_0(t)e^{\beta_2 x_2}} = \frac{e^{\beta_1 x_1}}{e^{\beta_2 x_2}}\)</span></p>
<p>The first part is reffered to as the hazard ratio.</p>
<p>This is a strong assumption, which we must make sure to check.</p>
</section>
<section id="advantagedisadvantage" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="advantagedisadvantage"><span class="header-section-number">6.2.2</span> Advantage/Disadvantage</h3>
<p>Advantages:</p>
<ul>
<li>We don’t have to make assumptions on the underlying distribution of the baseline hazard/survival functions. This is mitigates some of the strong assumptions required for AFTs (Weibull vs Exp, etc)</li>
<li>We are directly modelling the effect of the covariate on the hazard. To understand teh effects on hazard we just have to look at the signs of the covariates. In AFTs however it is not alwatys obvious and needs further calculation.</li>
</ul>
<p>Disadvantages: - As we haven’t specified a <span class="math inline">\(h_0\)</span> then given a vector of patient characteristics it it not possible to actually specify the hazard.</p>
<p>If you are just interested in which covariates effect hazard/survival then PH is fine. If you want to want to actually compute probabilities of survival/times, expectations, etc then AFTs are required. So for instance in a PH model you would be able to say:</p>
<ul>
<li>smoking triples hazard relative to not</li>
<li>treaetment halves hazard relative to placebo</li>
</ul>
<p>However you could not say that smoking 10 cigs a day decrease expected survival time by 2 or probability of a cancer paitient surving more than two years on new meds is 0.6.</p>
</section>
<section id="estimating-beta" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="estimating-beta"><span class="header-section-number">6.2.3</span> Estimating <span class="math inline">\(\beta\)</span></h3>
<p>We use likeihood methods. However notrmally we would say that</p>
<p><span class="math inline">\(Likelihood = \Pi^n_{i=1} f(t_i;\textbf{x}_i)^{\delta_i} S(t_i ; \textbf{x}_i)^{1-\delta_i}\)</span></p>
<p>This is also equal to (as <span class="math inline">\(f(t) = h(t)S(t)\)</span>)</p>
<p><span class="math inline">\(Likelihood = \Pi^n_{i=1} h(t;\textbf{x})^{\delta_i} S(t_i ; \textbf{x}_i)\)</span></p>
<p>Where <span class="math inline">\(t_i\)</span> is the min(Failure time, time of right censor) and <span class="math inline">\(\delta_i\)</span> is the indicator function where 1=death, 0 = censor.</p>
<p>However in PH we havent specified <span class="math inline">\(h_0(t)\)</span> so MLE isn’t possible. We therefore hae to use partial likelihood.</p>
<section id="partial-likelihood" class="level4" data-number="6.2.3.1">
<h4 data-number="6.2.3.1" class="anchored" data-anchor-id="partial-likelihood"><span class="header-section-number">6.2.3.1</span> Partial Likelihood</h4>
<p>If we know the times of which people died, then we want to understand the probability that they died in that particular observed order order.</p>
<p><span class="math inline">\(P(\text{Death}) \propto h\)</span></p>
<p>TODO : review partial likelihood!</p>
</section>
</section>
<section id="intrepreting-r-output" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="intrepreting-r-output"><span class="header-section-number">6.2.4</span> Intrepreting R output</h3>
<p>The wald score is the coeff/S.E. This is standard normal. It’s square is the <span class="math inline">\(\chi^2_1\)</span> which is useful in multi-level factors.</p>
<p>For an set of covariates <span class="math inline">\(\textbf{x} = (x_1, x_2, x_3....)'\)</span> you will get the the following hazard:</p>
<p><span class="math inline">\(h(t;\textbf{x} = h_0(t)e^{\beta_1 x_1 + \beta_2 x_2 ...}\)</span>.</p>
<p>Where you havea two level factopr Eg treatment. This becomes a binary case of x = 0 or 1. Therefore if we calculate the hazard for both case we get (assuming treatment has been set as the first variable and A = 0, B =1)</p>
<p>$ <span class="math inline">\(h(t;\textbf{x} = h_0(t)e^{\beta_1(0) + \beta_2 x_2 ...}\)</span></p>
<p>$ <span class="math inline">\(h(t;\textbf{x} = h_0(t)e^{\beta_1(1) + \beta_2 x_2 ...}\)</span>.</p>
<p>And if we calculate the hazard ratio of <span class="math inline">\(\frac{\text{Treatment B}}{\text{Treatment A}}\)</span> then the terms cancel to leave only <span class="math inline">\(e^{\beta_1}\)</span>. And so this is simply the hazard ratio for treatment on these covariates. This in turn means that the coeffieicnt itself is the log of the hazard ratio.</p>
<section id="significance" class="level4" data-number="6.2.4.1">
<h4 data-number="6.2.4.1" class="anchored" data-anchor-id="significance"><span class="header-section-number">6.2.4.1</span> Significance</h4>
<p>By asymptopic variance of the MLE</p>
<p><span class="math inline">\(\hat{\beta} \sim N(\beta, s.e.(\hat{\beta})^2)\)</span></p>
<p>So if you have either a two factor or continuous covariate you can compare either</p>
<ul>
<li>the <span class="math inline">\(\hat{\beta}/s.e.(\hat{\beta})\)</span> to a <span class="math inline">\(N(0,1)\)</span></li>
<li>or <span class="math inline">\((\hat{\beta}/s.e.(\hat{\beta}))^2\)</span> to a <span class="math inline">\(\chi_1^2\)</span></li>
</ul>
<p>Or where you have <span class="math inline">\(k &gt;2\)</span> factors you do the following:</p>
<ul>
<li>Calculate the <span class="math inline">\(\chi_i^2 = (\hat{\beta}_i/s.e.(\hat{\beta}_i))^2\)</span> for each of the k-1 variables</li>
<li><span class="math inline">\(\sum^{k-1}_{i=1}\chi_i^2\)</span> and compare to the <span class="math inline">\(\chi_{k-1}^2\)</span> dist.</li>
</ul>
</section>
<section id="process---binary" class="level4" data-number="6.2.4.2">
<h4 data-number="6.2.4.2" class="anchored" data-anchor-id="process---binary"><span class="header-section-number">6.2.4.2</span> Process - Binary</h4>
<ul>
<li>Significance</li>
<li>Direction</li>
<li>Quantify</li>
</ul>
<p>Say we are interested in a treatment B and A where. B is 1 and A is 0 in the model. It is <span class="math inline">\(\beta_1\)</span> in the model.</p>
<p>The first look at <span class="math inline">\(e^{\beta_1} = \frac{h{t;x_1=1}}{t;x_1=0}\)</span>:</p>
<ul>
<li>If <span class="math inline">\(e^{\beta_1} &lt;1\)</span> Then the factor with value 1 (often the treatment B) <strong>decreases</strong> the hazard <strong>relative</strong> to teatment A</li>
<li>If <span class="math inline">\(e^{\beta_1} &gt;1\)</span> Then the factor with value 1 (often the treatment B) <strong>Increases</strong> the hazard <strong>relative</strong> to teatment A</li>
</ul>
<p>We can put a CI on the Hazard ratio by taking the <span class="math inline">\(e^{\hat{\beta_1} \pm 1.96(s.e.(\hat{\beta_1}))}\)</span>. As it is a monotonic transform it holds.</p>
<p>The ratio can be directly reported as a percentage which is often easier for audience to understand. So a CI of hazard ratio 0.25 to 0.75 would be:</p>
<p>“Relapse Hazard on Treatmnt B is likley to be between 25% ad 75% of realpse hazard on Treatment A.”</p>
</section>
<section id="process---continuous" class="level4" data-number="6.2.4.3">
<h4 data-number="6.2.4.3" class="anchored" data-anchor-id="process---continuous"><span class="header-section-number">6.2.4.3</span> Process - Continuous</h4>
<p>In the case of the continuous what were are doing is calulating the following hazard ratio (this example used heart volume):</p>
<p><span class="math inline">\(\frac{h(t; \textbf{x}_4 = volume + 1)}{h(t; \textbf{x}_4 = volume)}\)</span></p>
<p>So how does hazard increase when a continuous unit increase by one. Which much like the hazard ratio for a bianry case you will get alot of cancellation. Obviously the other covariates just cancel based on the baseline and:</p>
<p>$ = e^{_4} $</p>
</section>
<section id="process---multi-level-factors" class="level4" data-number="6.2.4.4">
<h4 data-number="6.2.4.4" class="anchored" data-anchor-id="process---multi-level-factors"><span class="header-section-number">6.2.4.4</span> Process - Multi level factors</h4>
<p>Take k-1 factors and compute the available <span class="math inline">\(\chi^2\)</span> sum them and compare to the <span class="math inline">\(\chi^2_{k-1}\)</span>. Remeber the baseline is just absorbed into the intercept like any linear model.</p>
<p>Remember <span class="math inline">\(\chi^2\)</span> is one sided and therefore compare directly to 0.95 and not 0.975.</p>
</section>
<section id="in-the-examirl" class="level4" data-number="6.2.4.5">
<h4 data-number="6.2.4.5" class="anchored" data-anchor-id="in-the-examirl"><span class="header-section-number">6.2.4.5</span> In the exam/IRL</h4>
<blockquote class="blockquote">
<p>If you are asked to **Interpret the output uou must do the following:</p>
<ul>
<li>Significance : Does p-value drop below threshhold</li>
<li>Direction : Is hazard increased or decreased relative to the baseline</li>
<li>Quantify : Give a 95% CI for the hazard ratio.</li>
</ul>
</blockquote>
<p>TODO:</p>
<ul>
<li>Go through and derive log-log</li>
<li>Do the residual stuff</li>
<li>tito correction?</li>
<li>Revisit entire likelihood partial aspect 14:00 - 30:20 last lecture</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./linear_models.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>