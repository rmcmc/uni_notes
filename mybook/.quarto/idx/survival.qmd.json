{"title":"Survival","markdown":{"headingText":"Survival","containsRefs":false,"markdown":"\nWith survival analysis we aim to model lifetimes or populations. Survival analysis is unique as it aims to include censoring.\n\nhttps://www.youtube.com/watch?v=7_XK7mGMm1E&list=PLoROMvodv4rOzrYsAxzQyHb8n_RWNuS1e&index=79\n\n\n## Chapter 1 - Intro\n\nWe are interested in two types of cencoring\n\n- right : The failure occurs after a set time, died after trial\n- left : The failure occurs before the observations begin, died before trial starts\n\nThe fundamental probaility theory required is as follows\n\n### Distribution Function\n\nLet $T$ be the failure time, where $T>0$. Then as expected the distribution function is:\n\n$F(t) = P(T\\leq t)$\n\nAnd therefore the probability density is:\n\n$f(t) = F'(t)$\n\nAnd so\n\n$F(t) = \\int_0^tf(u)du$\n\n\n### Survivor Function\n\nGenerally we are interested in whether someone will survive longer than a certain time. So:\n\n$S(t) = P(T\\geq t) = 1 - F(t) = \\int^{\\infty}_t f(u) du$\n\nAs it is linked to the distribution function we can therefore say\n\n$f(t) = -S'(t)$\n\n### Hazard Function\n\nThe risk of death at time $t$ given survival to time $t$. Or the instantaenous risk of death at time $t$\n\n$h(t) = \\frac{f(t)}{S(t)}$\n\n### Integrated Hazard Function\n\n$H(t) = \\int^{t}_0 h(u) du = -log(S(t))$\n\nSo\n\n$S(t) = e^{\\left(-H(t)\\right)}$\n\nand\n\n$f(t) = h(t)e^{\\left(-H(t)\\right)}$\n\n\n\n### Limits worth knowing\n\n$f(t) = lim_{h \\rightarrow 0 } \\frac{P(t < T < t+h)}{h}$\n\nand\n\n$h(t) = lim_{h \\rightarrow 0 } \\frac{P(t \\leq T < t+h | T \\geq t)}{h}$\n\n## Chapter 2 - Distributions\n\n### Exponential\n\nThe only distribution with a constant hazard function.\n\n$T_i \\sim Exp(\\lambda, \\gamma)$\n\nProperty| equation\n-----|-----\n$f(t)$|$\\lambda e^{-\\lambda t}$\n$F(t)$|$1 - e^{-\\lambda t}$\n$S(t)$|$e^{-\\lambda t}$\n$h(t)$ | $\\lambda$\n\n\n### Weibull\n\nThe weibull can vary by implementation `survreg` uses the following implementation\n\n$T_i \\sim Weibull(\\lambda, \\gamma)$\n\nProperties should be given, **TO BE VERIFIED**\n\nIn this course:\n\n- $\\lambda$ is the shape\n- $\\gamma$ is the rate\n\nIt is extremely flexible, but can become unstable near $\\gamma = 1$. From $\\gamma$ we know the following:\n\n- $\\gamma = 1$ - Constant Hazard, becomes the exponential\n- $\\gamma > 1$ - Hazard INCREASES with time\n- $\\gamma < 1$ - Hazard DECREASES with time\n\n\n**TODO - Add plot to get a feel for various hazrds, etc**\n\n```{python}\nfrom scipy import stats\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nxs = np.arange(0,100,0.1)\ns_t = stats.expon(0,10).sf(xs)\nf_t = stats.expon(0,10).pdf(xs)\nplt.plot(xs,s_t)\n\n```\n\n## Chapter 2 - Life Tables\n\nSee notes - Two example type to be practiced exhaustively (No loss and loss to follow up)\n\nLifetables tabulate death rates over a period of time. They are useful non-parametric summaries and help to inform which parametric models might be sensible. \n\nIn the loss to follow up we assume in this course that:\n\n- $p_x$ and $q_x$ are constant over a time period, this is reasonable if short\n- We assume those who withdraw have the same probability of dieing as those who don't\n- We assume withdrawls are evenly spaced through the year\n\n## Chapter 2 - Kaplan-Meier\n\n\n```{r}\nrnorm(1)\n```\n\n\n## Chapter 3  - Two Sample\n\nKaplan-Meier is just a visual aid, we need to look at tests\n\n### Log Rank Test\n\nNon-parametric.\n\n\n$$ H_0 : S_1(t) = S_2(t)$$\n\n$$ H_A : S_1(t) \\neq S_2(t)$$ \n\n$H_A$ is for some $t$\n\nSteps:\n\n1) Create a table\n2) create an $i$ column for 1,2,..n\n3) create a $t_i$ column and list all the times of deaths only\n4) Create an $r_{1,i}$ and $r_{2,i}$ for at risk (At risk for a time includes those who died at that time and all future censorees)\n5) Sum  $r_{1,i}$ and $r_{2,i}$ to get $r_i$\n6) Create an $d_{1,i}$ and $d_{2,i}$ for death counts at the times\n7) Sum the deaths to get $d_i$\n8) Sum down death column to get observed $O_1$ and $O_2$\n9) Calc $e_{1,i} = (\\frac{r_{1,i}}{r_i})d_i$ and $e_{2,i}$\n10) Sum the $e_{1,i}$ and $e_{2,i}$ to get $E_1$ and $E_2$\n11) Calculate using below equation\n\n$$ LR = \\frac{(O_1 - E_1)^2}{E_1} + \\frac{(O_2 - E_2)^2}{E_2} \\sim \\chi^2_{1}$$\n\n\n\n### Parametric \n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"survival.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.47","bibliography":["references.bib"],"theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"survival.pdf"},"language":{},"metadata":{"block-headings":true,"bibliography":["references.bib"],"documentclass":"scrreprt"},"extensions":{"book":{}}}}}